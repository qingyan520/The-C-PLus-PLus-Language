数据库原理以及应用(学校)

数据库是按照一定的格式存储，是有组织的，可共享的，长期存储在计算机中的大量数据的集合

DBMS(数据库管理系统)是一种专门用于实现对数据进行管理和维护的系统软件

数据库系统(DBS)一般有数据库，数据库管理系统(以及相关使用工具),应用程序，数据库管理员(DBA)组成

数据独立性：指应用程序不会因数据的物理表示方式和访问计数的该表而改变，集体包括逻辑独立性和物理独立性



2.数据模型与数据库结构

实体联系模型

联系是数据之间的关联集合，分为两类：

实体，属性，联系

联系：一对一，一对多，多对一

关系型数据模型：把数据看成二维表中的11元素，而这个二维表就是关系，用关系表示实体和实体之间联系的模型称为关系数据模型



数据库系统结构：

1.根据模型应用的不同目的，数据模型通常分为两大类：概念模型和组织模型

2.E-R模型中涉及的三方面内容：实体，联系，属性

3.数据库系统采用三级模式和耳机映像技术的主要目的：解决独立性

第三章   关系数据库

3.1关系模型组成：

关系数据结构

关系操作：增删查改

关系完整性约束：保证数据正确性的特征

实体完整性

参照完整性

用户自定义完整性

3.2关系模型基本术语：

关系：关系就是二维表

关系表中的每一列都不可再分，表中的行，列次序不重要

属性：表中的每一列都是一个属性值集，列可以命名，称为属性名

值域：取值范围

元组：每一行称作一个元组

分量：元组中的每一个属性值称为元组的一个分量

关系模式：对应关系表的表明和表头

设关系名为R，属性值分别为A1，A2，A3，，，An,则关系模式可以表示为R(A1,A2,A3,,,,,,,,An)

关系数据库：对应于一个关系模型的所有关系的集合称为关系数据库

候选码：能唯一标识关系中一个元组的一个属性或最小属性组

主码(也称为主键或者主关键字)：当一个关系中有多个候选码时，可以从中选择一个作为主码，每个关系只能有一个住吗

主属性：包含在任一候选码中的属性

非主属性：不包含在任一候选码中的属性

主码的确定：主码是关系表中的一个属性或属性组，用于唯一地确定一个元组

主码可以由一个属性组成，也可以由多个属性共同组成

3.3关系模型的形式化定义





3.4关系模型的完整性约束

实体完整性：保证关系中的 每个元组都是可识别和唯一的，不容许无主码记录以及主码值相同地记录

主属性不能为空值

主码的值不能重复

参照完整性：用于描述实体之间的联系，一般是指多个实体之间的关联关系

参照的完整性规则：定义外码与主码之间的应用规则,应满足约束：
或者值为空

或者等于其所被参照的关系中的某个元组的主码值

用户定义地完整性

3.5关系代数

选择

投影

连接

等值连接

自然连接：自然连接去掉结果中的重复列

除



SQL Server配置管理器

设置服务启动方式

服务器端网络配置

客户端端网配置

SQL Server Management Studio



SQL Server数据库组成

用户可以在一个实例中创建多个数据库

每个数据库在物理上贺逻辑上都是独立的

SQL Server将数据库分为系统数据库和用户数据库

系统数据库保存系统信息

master:记录系统中所有系统信息

msdb:保存关于调度警报，作业，操作员等信息

model:用户数据库的模板，其中包括所有用户数据库的共享信息，当创建用户数据库时，系统将自动将model数据库中的全部内容复制到新建数据库中

tempdb:临时数据库，用于存储临时信息

数据库组成：数据文件(.mdf or .ndf)+日志文件(.lfd)

数据文件：用于存放数据库中的数据信息

日志文件：用于存放数据库的操作记录(至少有一个日志文件)



数据库文件的属性

文件名及其位置

初始大小

增长方式：指定文件是否自动增长(默认配置为容许增长)

最大大小:默认不限制，建议设置最大空间



SOL Server数据库分为系统数据库和用户数据库

数据库文件分为数据文件和日志文件

数据库文件四大属性：文件名及其位置，初始大小，增长方式，最大大小



第5章  数据类型及关系表创建

![image-20220316102504691](https://raw.githubusercontent.com/qingyan520/Cloud_img/master/img/image-20220316102504691.png)

SQL Server提供的主要数据类型

数字(数值)类型

bigint:8字节

int

smallint

tinyint

bit

![image-20220316103042870](https://raw.githubusercontent.com/qingyan520/Cloud_img/master/img/image-20220316103042870.png)

![image-20220316103055635](https://raw.githubusercontent.com/qingyan520/Cloud_img/master/img/image-20220316103055635.png)

字符串类型

![image-20220316103206105](https://raw.githubusercontent.com/qingyan520/Cloud_img/master/img/image-20220316103206105.png)

![image-20220316103226632](https://raw.githubusercontent.com/qingyan520/Cloud_img/master/img/image-20220316103226632.png)

![image-20220316103550162](https://raw.githubusercontent.com/qingyan520/Cloud_img/master/img/image-20220316103550162.png)

![image-20220316103743288](https://raw.githubusercontent.com/qingyan520/Cloud_img/master/img/image-20220316103743288.png)

日期时间类型

![image-20220316103758619](https://raw.githubusercontent.com/qingyan520/Cloud_img/master/img/image-20220316103758619.png)



5.3关系表的创建与维护

5.3.1创建关系表

```sql
CREATE TABLE <表名>(
	<列名1> <数据类型> [列级完整性约束性定义]
    {
    	<列名2> <数据类型> [列级完整性约束性定义]
    ...
    }
    [,表级完整性约束定义]

)
```

列级完整性约束定义出可以定义的约束：
NOT NULL：限制列取值非空

DEFAULT：给定列的默认值

UNIOU：限制列取值不重

CHECK：限制列的取值范围

PRIMARY KEY：指定本列为主码

FOREIGN KEY：定义本列为引用其他表的外码



5.3.2修改表结构

```sql
ALTER TABLE <表名>
[ALTER COLUMN <列名><新数据类型>] --修改列定义
[ADD <列名><数据类型><约束>]  --添加新列
[AROP COLUMN <列名>] --删除列
[ADD [constraint<约束名>]约束定义] --添加约束
[DROP[constraint]<约束名>]  --删除约束
```



5.4数据的完整性

5.4.1完整性约束条件大的作用对象

5.4.2实现数据完整性







5.3关系表的创建与维护











![image-20220325203243455](https://raw.githubusercontent.com/qingyan520/Cloud_img/master/img/image-20220325203243455.png)

![image-20220325203427204](https://raw.githubusercontent.com/qingyan520/Cloud_img/master/img/image-20220325203427204.png)

![image-20220325203519446](https://raw.githubusercontent.com/qingyan520/Cloud_img/master/img/image-20220325203519446.png)



修改表结构

设计—>











第6章

6.1数据查询功能

1.选择表中若干列

```sql
select Sno ，Sname from Student//从学生表查询姓名和学号
```

查询全体学生的姓名，学号，所在系

```sql
select Sname Sno From Student
```

2.查询全部列

```sql
SELECT * FROM Student
```

3.查询进过计算的列

```sql
查询全体学生的姓名及其出生年份
SELECT Sname ,year(data())-Sage FROM Student
```



改变列标题

```
列名|表达式 
SELECT Sname 姓名,'Year of Birth' '出生年份', 2010-Sage 年份
```

二.选择表中若干元组

1.消除取值相同的行

```
查询选浏览课程的学生的学号
SELECT DISTINCT Sno FROM SC
```

2.查询满足条件的元组

```
查询计算机系全体学生的姓名
SELECT Sname FROM Student WHERE Sdept ='计算机系'
```

```
查询考试成绩有不及格的学生的学号
SELECT DISTINCT Sno FROM SC WHERE Grade<60
```

（2）确定范围

```
BETWEEN....AND....//包括上限和下限，等价于a>=下线AND a<=上限

NOT BETWEEN...AND....//不在这个区间内，等价于 a<下线 OR a>上线
```

```
查询年龄在20~30岁之间的学生的姓名，所在系和年龄
SELECT Sname,Sdept,Sage FROM Student WHERE Sage BETWEEN 20 AND 30 
```

```
查询年龄不在20~23之间的学生姓名，所在系和年龄
SELECT Sname.Sdept,Sage From Student WHERE Sage NOT BETWEEN 20 AND 23
```

关于日期类型查询

```sql
查询2009年6月份出版的全部图书的详细信息
SELECT *FROM 图书表 WHERE 出版日期 BETWEEN '2009/6/1'AND '2009/6/30'
```

（3）确定集合

```
使用IN运算符查找属性值属于指定集合的元组，格式为：
列名 [NOT] IN(常量1(c1)，常量2(c2).....常量n(cn))
返回true或者false
等价于 a==c1 OR a==c2 ......OR a==cn
```

```
查询信息系，数学系和计算机系学生的姓名
SELECT Sname,Ssex From Student WHERE Sdept IN('信息系'，'数学系','计算机系')
```

```
查询信息系和计算机系之外的其他系的学生新民新版和所在系
SELECT Sname,Ssex FROM Student WHERE Sdept NOT IN('信息系','计算机系')
```

(4)字符串匹配

```
使用LIKE运算符，一般形式为:
列名 [NOT] LIKE <匹配串>
匹配串中可包含如下四种通配符
_:匹配任意一个字符
%：匹配0个或多个字符
[]：匹配[]中的任意一个字符；对于连续字母的匹配，例如匹配[adcd],可以写为[a-d]
[^]:不匹配[]中的任意一个字符

```

```
查询姓‘张’的通信的详细信息
SELECT*FROM Student WHERE Sname LIKE '张%'
```

```
查询学生表中姓姓'张'，‘李’，‘刘’的学生情况
SELECT * FROME Student WHERE Sname LIKE '[张李刘]%'

```

```
查询名字中的第二个字为‘小’或者‘大’的学生的姓名和学号
SELECT Sname,Sno FROM Student WHERE Sname LIKE '_[小大]%'
```

```
查询所有不姓张也不姓王的同学
SELECT Sname FROM Student WHERE Sname NOT LIKE '[王张]%'
```

```
查询姓王且名字是2个字的学生姓名
SELECT Sname FROM Student WHERE  like '[王_ ]'
查询名字姓王且是3个字的学生名字
SELECT Snmae FROM Student WHERE Sname LIKE '王__'
```

```
查询学生表中学号最后以一位不是2，3，5的学生信息
SELECT* FROM Student WHERE Sno LIKE '%[^235]'
```





转义字符

如果要查找的字符串正好含有通配符，比如下划线或百分号，就需要使用特殊句子来告诉系统这就是一个下划线或者普通的字符，用法如下：

ESCAPE 转义字符

```
查找某列包含30%的记录
列名 LIKE '30%!%%' ESCAPE'!' 
```

(5)设计空值的查询

```
列名 IS NULL

不为空
列名 IS NOT NULL
```

```
查询没有考试成绩的学生的学号和相应的课程号
SELECT Sno,Cno FROM SC WHERE Grade IS NULL

出啊寻所有有考试成绩的的学生的学号和课程号
SELECT Sno,Cno FROM SC WHERE Grade IS NOT NULL
```

(6)多重条件查询

```
查询计算机系年龄在20岁以下的学生姓名
SELECT Snmae FROM Student WHRER Sdeotp
```

三.对查询结构进行排序

```
ORDER BY 列名 ASC(升序)|DESC(降序)排序

```

```
查询选修了c02号课程的学生的学号及其成绩，查询结构按成绩降序排列
SELECT Sno Grade FROM SC WHERE Cno='c02' ORDER BY GRADE DESC
```

```
查询全体学生的信息，查询结果按照所在系的系名升序排列，同一系的学生按照年龄降序排列
SELECT *FROM Student ORDER BY Sdept,Sage DESC
```



四，使用聚合函数汇总数据

![image-20220406205716331](https://raw.githubusercontent.com/qingyan520/Cloud_img/master/img/image-20220406205716331.png)

```
//统计学生总人数
SELECT COUNT(*)FROM Student
```

```
统计选修了课程的学生的人数
SELECT COUNT(DISTINCT Sno) FROM SC
```

```
统计951201号学生的考试成绩之和
SELECT SUM(Grade) FROM SC WHERE Sno='9512101'

```

```
查询‘9512101’学生的选课门数，已考试课程门数以及考试最高分，最低分和平均分
 
SELECT COUNT(*) AS 选课门数
COUNT(Grade) AS 考试门数
MAX(Grade) AS 最高分
MIN(Grade) AS 最低分
AVG(Grade) AS 平均分
FROM SC WHERE Sno='9512101'
```

五.对查询结果进行分组统计

![image-20220408205233276](https://raw.githubusercontent.com/qingyan520/Cloud_img/master/img/image-20220408205233276.png)

```
统计每门课程的选课人数，输出课程号好人数
SELECT Con as 课程号，COUNT(Sno) as 选课人数 FROM SC GROUP BY Cno
```

```
查询每个学生的选课门数和平均成绩
SELECT Sno as 学号，COUNT(*) as 选课门数，AVG(Grade) as平均成绩 FROM SC  GROUP BY Sno
```

![image-20220408210025136](https://raw.githubusercontent.com/qingyan520/Cloud_img/master/img/image-20220408210025136.png)

```
统计每个系学生人数和平均年龄
SELECT Sdept,COUNT(*)as 学生人数，AVG(Sage) as 平均年龄
FROM Student GROUP BY Sdept
```

![image-20220408210700635](https://raw.githubusercontent.com/qingyan520/Cloud_img/master/img/image-20220408210700635.png)

![image-20220408211030355](https://raw.githubusercontent.com/qingyan520/Cloud_img/master/img/image-20220408211030355.png)

![image-20220408211305462](https://raw.githubusercontent.com/qingyan520/Cloud_img/master/img/image-20220408211305462.png)



6.1.3多表连接查询

![image-20220408211531238](https://raw.githubusercontent.com/qingyan520/Cloud_img/master/img/image-20220408211531238.png)

![image-20220408211616350](https://raw.githubusercontent.com/qingyan520/Cloud_img/master/img/image-20220408211616350.png)

![image-20220408211752686](https://raw.githubusercontent.com/qingyan520/Cloud_img/master/img/image-20220408211752686.png)

![image-20220408212041154](https://raw.githubusercontent.com/qingyan520/Cloud_img/master/img/image-20220408212041154.png)

![image-20220408212331795](https://raw.githubusercontent.com/qingyan520/Cloud_img/master/img/image-20220408212331795.png)



多表连接查询

```
查询信息系修了“计算机啊文化学”课程的学生信息，要求列出选课人数
```



2.自连接：相互连接的表物理上为同一张表

必须为两张表起别名，是之成为逻辑上两个表

```
from 表1 AS T1 join 表1 as T2
```

```
查询与刘畅头一个系学习的学生的姓名和所在的系
select s2.Sname,s2.Sdept from student s1 join student s2 on s1.dept=s2.dept where s1.Sname='刘畅'and s2.Sname!='刘畅' 
```

3.外连接

```
只限制一张表中的数据必须满足连接的条件，而另一张表中的数据可以不满足连接条件
```

```
from 表1  left|right [outer] join 表2 on 连接条件
```



6.1.4使用top限制结果集行数

```
top n：取前n行数据
top n percnet :取结果前n%
with ties:包括并列的结果
```

查询前3名

```
select top 3 sname sage form student order by age desc;
```



6.1.5子查询

1.基于集合的查询

```
查询与刘畅在同一个系的学生
selct sno,sname sdept from student where sdept in (select sdept from student where sanme='刘畅') and sname!='刘畅';
```





6.1.6将查询结果保存到新表中

![image-20220420085115196](C:\Users\史金伟\AppData\Roaming\Typora\typora-user-images\image-20220420085115196.png)





6.2数据更改功能

insert into…

插入子查询的结果

```sql

```

6.2.2更新数据

```sql
update table_name set 列名=值 where 更新条件
```

1.无条件更新

```sql
update student set sage=sage+1;
```

2.有条件更新

```sql
(1).基于本表条件的更新
update student set sage=21 where sno='9512101';


(2).基于其它表谈条件的更新
将计算机系全体学生的成绩加5分
1）.用子查询实现
update sc set grade=greade+5 where sno  in (select son from studeny where sdept='计算机系');

```



6.3删除数据

```sql
delete from table_name where 删除条件

```

```sql
1.基于本表条件的删除
删除所有不及格学生修个记录

2.基于其它表条件的删除
删除计算机系不及格学生的修课记录
d
```

